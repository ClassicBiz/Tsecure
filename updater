current = "1.2"

function downloadFiles(urlFile, pathFile)
    local url = "https://raw.githubusercontent.com/ClassicBiz/Tsecure/master/" .. urlFile
    print("Downloading From >>")
    print(url)
    for i = 1, 3 do
        local response1 = http.get(url)
        if response then
            local data1 = response1.readAll()
            if pathFile then
                local path = "/Tsecure/" .. pathFile
                print("Saving to >>")
                print(path)
                local file = fs.open(path, "w")
                file.write(data1)
                file.close()
            end
            return true
        end
    end
    return false
end

function checkForUpdates(updateUrl)
	for i = 1, 2 do
		local response = http.get(updateUrl)
		if response then
			local data = response.readAll()
			if data == current then
				print("You're all up to date!")
				i = i + 1
				return true
			else
				print("A new update is avaliable.")
				sleep(1)
				if fs.exists("/Tsecure/installer.lua") then
					fs.delete("/Tsecure/installer.lua")
				end
				downloadFiles("installer", "installer.lua")
				shell.run("/Tsecure/installer.lua")
			end
		end
	end
end
checkForUpdates("https://raw.githubusercontent.com/ClassicBiz/Tsecure/master/version")
